# 関数呼び出し

## レジスタ

関数呼び出しに関して、RKISAでは、レジスタを３種類に分けている。

1. T (Temporary) レジスタ

関数側が自由に書き換えることができる。

関数の前後で保存したい場合、Caller（関数を呼び出した側）の責任で保存する必要がある。

2. S (Save) レジスタ

関数呼び出しの前後で値が保存されるレジスタ。

Callee（呼び出された側、関数側）が値を保存する。

関数内で使いたければ、関数が処理を行う前に、退避しておく必要がある。

3. A (Argument) レジスタ

関数の引数と返値を入れるレジスタ。

関数側が自由に書き換えることができるので、Tレジスタの一種ともみなせる。

```C:
{
    int a;       // a:A
    int b;       //  |  b:S
    int c;       //  |   |  c:S
    c = hoge(a); //  x   |   |
    int d;       //      |   |  d:T
    d = c+b;     //      |   |   |
}
```

## プログラムカウンタ

関数の後に帰ってくる

## コードの解説

1. 呼び出し側
  1. Tレジスタ、Aレジスタをスタックに退避する
  2. 引数をAレジスタにセット
  3. jump ra で関数にジャンプ

この時のスタック

|   |     |
| - | --- |
|   |     |
|   | PC  |
|   | Arg |
|   | T4  |
|   |  :  |
|   | A0  |
|   | BP  |

2. 関数側
  1. Sレジスタをスタックに退避する
  2. 引数をレジスタにセット
  3. 引数をAレジスタに置く

3. 呼び出し側

