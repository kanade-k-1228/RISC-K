# RKEMU

RISC-K のエミュレータです。オプション一覧は `rkemu -?` で見れます。

こういうふうに、命令を手書きしてもシュミレーションできる

```Cpp:
int main() {
  CPU cpu;
  cpu.loadi(T0, 0x1111);
  cpu.loadi(T1, 0x2222);
  cpu.add(T0, T0, T1);
  // cpu.dump();
  return 0;
}
```

## ダンプ設定ファイル (.dump)

エミュレート中のある時点でのレジスタ値を吐き出します。
また、メモリのアドレスを指定すれば、その値も吐き出します。

```
0x92 0x40 - 0x44 0x50 - 0x55
```

PC = 0x92 のとき、ダンプします。また、0x40 から 0x44 、および 0x50 から 0x55 番地のメモリの値もダンプします。

## 割り込み設定ファイル (.intr)

割り込みをエミュレート中のある時刻で発生させます。
エミュレート時刻 t は、エミュレート開始時点からのクロックをカウントします。

```
0x0100 1
```

エミュレート時刻 t = 0x0100 のときに、1 番の割り込みを発火します。

## 出力装置

デバッグ用に、シリアル出力みたいな出力装置があります。

`COUT` : シリアル出力制御レジスタ

0でない値が入ると、出力します。

```C:
mem.at(COUT) = 'h';
mem.at(COUT) = 'i';
// > hi
```

こんなかんじ。

```C:
void print(char *buf){
  while(*buf != 0){
    mem.at(COUT) = *buf;
  }
  return;
}
```

## 参考文献

https://catalog.lib.kyushu-u.ac.jp/opac_download_md/1441262/isee530.pdf
