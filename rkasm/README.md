# RKASM

RK16 用のアセンブラです。

## ラベル

即値のかわりに、ラベルを参照することができる。

### 命令ラベル

`hoge:`

アセンブラ中の、`:` で終わる行は、命令ラベルの定義。

命令ラベル定義行から数えて、次に出現する命令行のアドレスを参照する。

### 変数ラベル

`@0xffff hoge`

アセンブラ中の、`@` で始まる行は、変数ラベルの定義。

RAM のアドレスに別名をつけることができる。

`load t0 zero hoge` のように、アドレスを人間にわかりやすく扱える。

同じアドレスに対して、複数のラベルが貼られている場合は、Warningを出す。（未実装）
が、`.` で始まるラベルは除外する（構造体のメンバへの相対参照）

### 定数ラベル

`#0x1234 fuga`

アセンブラ中の、`#` で始まる行は、定数ラベルの定義。

即値に対して、置換を行う。

### 型チェック（未実装）

命令によって、受け取れるラベルが異なる。

- loadi : 即値ロード : OPR, VAR, CONST
   - すべてのラベルを受け付ける
- calci : 即値演算 : CONST
   - 上位 4bit が消えるので、命令ラベル、変数ラベルを入れると、思い通りに動かないことがある
- load, store : メモリロード、ストア : VAR
   - RAM のアドレスを指定する
- jump, breq, brlt : 分岐、ジャンプ : OPR

## 疑似命令（未実装）

- mov x1 x2 = store x1 zero x2
- push x = store x zero, addi sp 1
- pop x = subi sp 1, load x zero
- call
- ret

## TODO

ラベルをMapで持つ
